name: Build and test

run-name: ${{ github.actor }} is building and testing

# Run the jobs for pushes and pull requests targetting main branch.
# NOTE: Strategy matrix can be mostly replaced with presets.
on: 
  push:
    branches:
      - CI

jobs:
  linux-build:
    runs-on: ubuntu-20.04
    timeout-minutes: 3

    strategy:
      matrix:
        build:
          - 1
        include:
          - build: 1
            build-type: Release
            build-tests: 'ON'

    name: 'Ubuntu 20.04
      <type=${{ matrix.build-type }},
       tests=${{ matrix.build-tests }}>'

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Download Maya SDK
        run: |
          pwd
          cd ..
          curl -o devkit.tgz https://autodesk-adn-transfer.s3-us-west-2.amazonaws.com/ADN+Extranet/M%26E/Maya/devkit+2024/Autodesk_Maya_2024_2_Update_DEVKIT_Linux.tgz
      - name: Extract SDK Files
        run: |
          tar -xvf devkit.tgz
          ls -l
      - name: Create build directories
        run: |
          mkdir .build
      - name: Configure
        run: |
          cmake -DCMAKE_BUILD_TYPE=${{ matrix.build-type }} \
                -S . \
                -B .build
